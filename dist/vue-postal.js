!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t["vue-postal"]=e()}(this,function(){"use strict";function t(t){let e,n,i=arguments.length;for(e=1;e<i;e++)for(n in arguments[e])t[n]=arguments[e][n];return t}function e(e,n){let i,s=arguments.length;for(e.prototype=function(t){let e=function(){};return e.prototype=t,new e}(n.prototype),e.prototype.constructor=e,i=2;i<s;i++)t(e.prototype,arguments[i]);return e}const n=["<nothing>"],i="end",s="value",r="error",h="any";function o(t,e){let n,i,s,r;if(0===t.length)return e;if(0===e.length)return t;for(r=0,n=new Array(t.length+e.length),i=t.length,s=0;s<i;s++,r++)n[r]=t[s];for(i=e.length,s=0;s<i;s++,r++)n[r]=e[s];return n}function u(t,e){let n,i=t.length;for(n=0;n<i;n++)if(t[n]===e)return n;return-1}function l(t,e){let n,i=t.length;for(n=0;n<i;n++)if(e(t[n]))return n;return-1}function a(t){let e,n=t.length,i=new Array(n);for(e=0;e<n;e++)i[e]=t[e];return i}function _(t,e){let n,i,s,r=t.length;if(e>=0&&e<r){if(1===r)return[];for(n=new Array(r-1),i=0,s=0;i<r;i++)i!==e&&(n[s]=t[i],s++);return n}return t}function c(t,e){let n,i=t.length,s=new Array(i);for(n=0;n<i;n++)s[n]=e(t[n]);return s}function f(t,e,n){t===h?e(n):t===n.type&&(t===s||t===r?e(n.value):e())}function d(){this._items=[],this._spies=[],this._inLoop=0,this._removedItems=null}function p(){this._dispatcher=new d,this._active=!1,this._alive=!0,this._activating=!1,this._logHandlers=null,this._spyHandlers=null}function m(){p.call(this)}function y(){p.call(this),this._currentEvent=null}t(d.prototype,{add(t,e){return this._items=o(this._items,[{type:t,fn:e}]),this._items.length},remove(t,e){const n=l(this._items,n=>n.type===t&&n.fn===e);return 0!==this._inLoop&&-1!==n&&(null===this._removedItems&&(this._removedItems=[]),this._removedItems.push(this._items[n])),this._items=_(this._items,n),this._items.length},addSpy(t){return this._spies=o(this._spies,[t]),this._spies.length},removeSpy(t){return this._spies=_(this._spies,this._spies.indexOf(t)),this._spies.length},dispatch(t){this._inLoop++;for(let e=0,n=this._spies;null!==this._spies&&e<n.length;e++)n[e](t);for(let i=0,s=this._items;i<s.length&&null!==this._items;i++)null!==this._removedItems&&(e=this._removedItems,n=s[i],-1!==u(e,n))||f(s[i].type,s[i].fn,t);var e,n;this._inLoop--,0===this._inLoop&&(this._removedItems=null)},cleanup(){this._items=null,this._spies=null}}),t(p.prototype,{_name:"observable",_onActivation(){},_onDeactivation(){},_setActive(t){this._active!==t&&(this._active=t,t?(this._activating=!0,this._onActivation(),this._activating=!1):this._onDeactivation())},_clear(){this._setActive(!1),this._dispatcher.cleanup(),this._dispatcher=null,this._logHandlers=null},_emit(t,e){switch(t){case s:return this._emitValue(e);case r:return this._emitError(e);case i:return this._emitEnd()}},_emitValue(t){this._alive&&this._dispatcher.dispatch({type:s,value:t})},_emitError(t){this._alive&&this._dispatcher.dispatch({type:r,value:t})},_emitEnd(){this._alive&&(this._alive=!1,this._dispatcher.dispatch({type:i}),this._clear())},_on(t,e){return this._alive?(this._dispatcher.add(t,e),this._setActive(!0)):f(t,e,{type:i}),this},_off(t,e){if(this._alive){0===this._dispatcher.remove(t,e)&&this._setActive(!1)}return this},onValue(t){return this._on(s,t)},onError(t){return this._on(r,t)},onEnd(t){return this._on(i,t)},onAny(t){return this._on(h,t)},offValue(t){return this._off(s,t)},offError(t){return this._off(r,t)},offEnd(t){return this._off(i,t)},offAny(t){return this._off(h,t)},observe(t,e,n){const h=this;let o=!1;const u=t&&"function"!=typeof t?t:{value:t,error:e,end:n},l=function(t){t.type===i&&(o=!0),t.type===s&&u.value?u.value(t.value):t.type===r&&u.error?u.error(t.value):t.type===i&&u.end&&u.end(t.value)};return this.onAny(l),{unsubscribe(){o||(h.offAny(l),o=!0)},get closed(){return o}}},_ofSameType(t,e){return t.prototype.getType()===this.getType()?t:e},setName(t,e){return this._name=e?`${t._name}.${e}`:t,this},log(t=this.toString()){let e,n=function(n){let s=`<${n.type}${e?":current":""}>`;n.type===i?console.log(t,s):console.log(t,s,n.value)};return this._alive&&(this._logHandlers||(this._logHandlers=[]),this._logHandlers.push({name:t,handler:n})),e=!0,this.onAny(n),e=!1,this},offLog(t=this.toString()){if(this._logHandlers){let e=l(this._logHandlers,e=>e.name===t);-1!==e&&(this.offAny(this._logHandlers[e].handler),this._logHandlers.splice(e,1))}return this},spy(t=this.toString()){let e=function(e){let n=`<${e.type}>`;e.type===i?console.log(t,n):console.log(t,n,e.value)};return this._alive&&(this._spyHandlers||(this._spyHandlers=[]),this._spyHandlers.push({name:t,handler:e}),this._dispatcher.addSpy(e)),this},offSpy(t=this.toString()){if(this._spyHandlers){let e=l(this._spyHandlers,e=>e.name===t);-1!==e&&(this._dispatcher.removeSpy(this._spyHandlers[e].handler),this._spyHandlers.splice(e,1))}return this}}),p.prototype.toString=function(){return`[${this._name}]`},e(m,p,{_name:"stream",getType:()=>"stream"}),e(y,p,{_name:"property",_emitValue(t){this._alive&&(this._currentEvent={type:s,value:t},this._activating||this._dispatcher.dispatch({type:s,value:t}))},_emitError(t){this._alive&&(this._currentEvent={type:r,value:t},this._activating||this._dispatcher.dispatch({type:r,value:t}))},_emitEnd(){this._alive&&(this._alive=!1,this._activating||this._dispatcher.dispatch({type:i}),this._clear())},_on(t,e){return this._alive&&(this._dispatcher.add(t,e),this._setActive(!0)),null!==this._currentEvent&&f(t,e,this._currentEvent),this._alive||f(t,e,{type:i}),this},getType:()=>"property"});const v=new m;function b(){return v}function E(t){function n(t,e){m.call(this),this._wait=t,this._intervalId=null,this._$onTick=(()=>this._onTick()),this._init(e)}return e(n,m,{_init(){},_free(){},_onTick(){},_onActivation(){this._intervalId=setInterval(this._$onTick,this._wait)},_onDeactivation(){null!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)},_clear(){m.prototype._clear.call(this),this._$onTick=null,this._free()}},t),n}v._emitEnd(),v._name="never";const g=E({_name:"later",_init({x:t}){this._x=t},_free(){this._x=null},_onTick(){this._emitValue(this._x),this._emitEnd()}});const w=E({_name:"interval",_init({x:t}){this._x=t},_free(){this._x=null},_onTick(){this._emitValue(this._x)}});const A=E({_name:"sequentially",_init({xs:t}){this._xs=a(t)},_free(){this._xs=null},_onTick(){1===this._xs.length?(this._emitValue(this._xs[0]),this._emitEnd()):this._emitValue(this._xs.shift())}});const S=E({_name:"fromPoll",_init({fn:t}){this._fn=t},_free(){this._fn=null},_onTick(){const t=this._fn;this._emitValue(t())}});function V(t){function e(e){return t._emitValue(e),t._active}function n(e){return t._emit(e.type,e.value),t._active}return{value:e,error:function(e){return t._emitError(e),t._active},end:function(){return t._emitEnd(),t._active},event:n,emit:e,emitEvent:n}}const T=E({_name:"withInterval",_init({fn:t}){this._fn=t,this._emitter=V(this)},_free(){this._fn=null,this._emitter=null},_onTick(){(0,this._fn)(this._emitter)}});function $(t){m.call(this),this._fn=t,this._unsubscribe=null}function C(t){return new $(t)}function k(t,e){switch(e){case 0:return function(){return t()};case 1:return function(e){return t(e[0])};case 2:return function(e){return t(e[0],e[1])};case 3:return function(e){return t(e[0],e[1],e[2])};case 4:return function(e){return t(e[0],e[1],e[2],e[3])};default:return function(e){return t.apply(null,e)}}}e($,m,{_name:"stream",_onActivation(){const t=(0,this._fn)(V(this));this._unsubscribe="function"==typeof t?t:null,this._active||this._callUnsubscribe()},_callUnsubscribe(){null!==this._unsubscribe&&(this._unsubscribe(),this._unsubscribe=null)},_onDeactivation(){this._callUnsubscribe()},_clear(){m.prototype._clear.call(this),this._fn=null}});const I=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"]];function O(t){this._currentEvent={type:"value",value:t,current:!0}}function x(t){return new O(t)}function L(t){this._currentEvent={type:"error",value:t,current:!0}}function P(t,e){return function(n,i){t.call(this),this._source=n,this._name=`${n._name}.${e}`,this._init(i),this._$handleAny=(t=>this._handleAny(t))}}function H(t){return{_init(){},_free(){},_handleValue(t){this._emitValue(t)},_handleError(t){this._emitError(t)},_handleEnd(){this._emitEnd()},_handleAny(t){switch(t.type){case s:return this._handleValue(t.value);case r:return this._handleError(t.value);case i:return this._handleEnd()}},_onActivation(){this._source.onAny(this._$handleAny)},_onDeactivation(){this._source.offAny(this._$handleAny)},_clear(){t.prototype._clear.call(this),this._source=null,this._$handleAny=null,this._free()}}}function D(t,n){const i=P(m,t);return e(i,m,H(m),n),i}function M(t,n){const i=P(y,t);return e(i,y,H(y),n),i}e(O,y,{_name:"constant",_active:!1,_activating:!1,_alive:!1,_dispatcher:null,_logHandlers:null}),e(L,y,{_name:"constantError",_active:!1,_activating:!1,_alive:!1,_dispatcher:null,_logHandlers:null});const N=M("toProperty",{_init({fn:t}){this._getInitialCurrent=t},_onActivation(){if(null!==this._getInitialCurrent){const t=this._getInitialCurrent;this._emitValue(t())}this._source.onAny(this._$handleAny)}});function q(t,e=null){if(null!==e&&"function"!=typeof e)throw new Error("You should call toProperty() with a function or no arguments.");return new N(t,{fn:e})}const B=D("changes",{_handleValue(t){this._activating||this._emitValue(t)},_handleError(t){this._activating||this._emitError(t)}});function W(){if("function"==typeof Promise)return Promise;throw new Error("There isn't default Promise, use shim or parameter")}var U=function(t){var e,n=t.Symbol;return"function"==typeof n?n.observable?e=n.observable:(e=n("observable"),n.observable=e):e="@@observable",e}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),j=U.default?U.default:U;function F(t){this._observable=t.takeErrors(1)}function Q(){return new F(this)}function z(t,e,n){for(var i in t)t.hasOwnProperty(i)&&(e.push(i),n.push(t[i]))}function Y(t,e,i){m.call(this),this._activeCount=t.length,this._sources=o(t,e),this._combinator=i,this._aliveCount=0,this._latestValues=new Array(this._sources.length),this._latestErrors=new Array(this._sources.length),function(t,e){let n,i=t.length;for(n=0;n<i;n++)t[n]=e}(this._latestValues,n),this._emitAfterActivation=!1,this._endAfterActivation=!1,this._latestErrorIndex=0,this._$handlers=[];for(let t=0;t<this._sources.length;t++)this._$handlers.push(e=>this._handleAny(t,e))}function K(t,e,n){return"function"==typeof e&&(n=e,e=void 0),Array.isArray(t)?function(t,e=[],n){if(!Array.isArray(e))throw new Error("Combine can only combine active and passive collections of the same type.");return n=n?k(n,t.length+e.length):t=>t,0===t.length?b():new Y(t,e,n)}(t,e,n):function(t,e={},n){if("object"!=typeof e||Array.isArray(e))throw new Error("Combine can only combine active and passive collections of the same type.");let i=[],s=[],r=[];return z(t,i,s),z(e,i,r),0===s.length?b():new Y(s,r,t=>{let e={};for(let n=t.length-1;0<=n;n--)e[i[n]]=t[n];return n?n(e):e})}(t,e,n)}t(F.prototype,{subscribe(t,e,n){const h="function"==typeof t?{next:t,error:e,complete:n}:t,o=t=>{t.type===i&&(u=!0),t.type===s&&h.next?h.next(t.value):t.type===r&&h.error?h.error(t.value):t.type===i&&h.complete&&h.complete(t.value)};this._observable.onAny(o);let u=!1;return{unsubscribe:()=>{u=!0,this._observable.offAny(o)},get closed(){return u}}}}),F.prototype[j]=function(){return this},e(Y,m,{_name:"combine",_onActivation(){this._aliveCount=this._activeCount;for(let t=this._activeCount;t<this._sources.length;t++)this._sources[t].onAny(this._$handlers[t]);for(let t=0;t<this._activeCount;t++)this._sources[t].onAny(this._$handlers[t]);this._emitAfterActivation&&(this._emitAfterActivation=!1,this._emitIfFull()),this._endAfterActivation&&this._emitEnd()},_onDeactivation(){let t,e=this._sources.length;for(t=0;t<e;t++)this._sources[t].offAny(this._$handlers[t])},_emitIfFull(){let t=!0,e=!1,i=this._latestValues.length,s=new Array(i),r=new Array(i);for(let h=0;h<i;h++)s[h]=this._latestValues[h],r[h]=this._latestErrors[h],s[h]===n&&(t=!1),void 0!==r[h]&&(e=!0);if(t){const t=this._combinator;this._emitValue(t(s))}e&&this._emitError(function(t){let e;for(let n=0;n<t.length;n++)void 0!==t[n]&&(void 0===e||e.index<t[n].index)&&(e=t[n]);return e.error}(r))},_handleAny(t,e){e.type===s||e.type===r?(e.type===s&&(this._latestValues[t]=e.value,this._latestErrors[t]=void 0),e.type===r&&(this._latestValues[t]=n,this._latestErrors[t]={index:this._latestErrorIndex++,error:e.value}),t<this._activeCount&&(this._activating?this._emitAfterActivation=!0:this._emitIfFull())):t<this._activeCount&&(this._aliveCount--,0===this._aliveCount&&(this._activating?this._endAfterActivation=!0:this._emitEnd()))},_clear(){m.prototype._clear.call(this),this._sources=null,this._latestValues=null,this._latestErrors=null,this._combinator=null,this._$handlers=null}});const R={empty:()=>b(),concat:(t,e)=>t.merge(e),of:t=>x(t),map:(t,e)=>e.map(t),bimap:(t,e,n)=>n.mapErrors(t).map(e),ap:(t,e)=>K([t,e],(t,e)=>t(e)),chain:(t,e)=>e.flatMap(t)};var G=Object.freeze({Observable:R});const J={_init({fn:t}){this._fn=t},_free(){this._fn=null},_handleValue(t){const e=this._fn;this._emitValue(e(t))}},X=D("map",J),Z=M("map",J),tt=t=>t;function et(t,e=tt){return new(t._ofSameType(X,Z))(t,{fn:e})}const nt={_init({fn:t}){this._fn=t},_free(){this._fn=null},_handleValue(t){(0,this._fn)(t)&&this._emitValue(t)}},it=D("filter",nt),st=M("filter",nt),rt=t=>t;const ht={_init({n:t}){this._n=t,t<=0&&this._emitEnd()},_handleValue(t){0!==this._n&&(this._n--,this._emitValue(t),0===this._n&&this._emitEnd())}},ot=D("take",ht),ut=M("take",ht);const lt={_init({n:t}){this._n=t,t<=0&&this._emitEnd()},_handleError(t){0!==this._n&&(this._n--,this._emitError(t),0===this._n&&this._emitEnd())}},at=D("takeErrors",lt),_t=M("takeErrors",lt);const ct={_init({fn:t}){this._fn=t},_free(){this._fn=null},_handleValue(t){(0,this._fn)(t)?this._emitValue(t):this._emitEnd()}},ft=D("takeWhile",ct),dt=M("takeWhile",ct),pt=t=>t;const mt={_init(){this._lastValue=n},_free(){this._lastValue=null},_handleValue(t){this._lastValue=t},_handleEnd(){this._lastValue!==n&&this._emitValue(this._lastValue),this._emitEnd()}},yt=D("last",mt),vt=M("last",mt);const bt={_init({n:t}){this._n=Math.max(0,t)},_handleValue(t){0===this._n?this._emitValue(t):this._n--}},Et=D("skip",bt),gt=M("skip",bt);const wt={_init({fn:t}){this._fn=t},_free(){this._fn=null},_handleValue(t){const e=this._fn;null===this._fn||e(t)||(this._fn=null),null===this._fn&&this._emitValue(t)}},At=D("skipWhile",wt),St=M("skipWhile",wt),Vt=t=>t;const Tt={_init({fn:t}){this._fn=t,this._prev=n},_free(){this._fn=null,this._prev=null},_handleValue(t){const e=this._fn;this._prev!==n&&e(this._prev,t)||(this._prev=t,this._emitValue(t))}},$t=D("skipDuplicates",Tt),Ct=M("skipDuplicates",Tt),kt=(t,e)=>t===e;function It(t,e=kt){return new(t._ofSameType($t,Ct))(t,{fn:e})}const Ot={_init({fn:t,seed:e}){this._fn=t,this._prev=e},_free(){this._prev=null,this._fn=null},_handleValue(t){if(this._prev!==n){const e=this._fn;this._emitValue(e(this._prev,t))}this._prev=t}},xt=D("diff",Ot),Lt=M("diff",Ot);function Pt(t,e){return[t,e]}const Ht=M("scan",{_init({fn:t,seed:e}){this._fn=t,this._seed=e,e!==n&&this._emitValue(e)},_free(){this._fn=null,this._seed=null},_handleValue(t){const e=this._fn;null===this._currentEvent||this._currentEvent.type===r?this._emitValue(this._seed===n?t:e(this._seed,t)):this._emitValue(e(this._currentEvent.value,t))}});const Dt=D("flatten",{_init({fn:t}){this._fn=t},_free(){this._fn=null},_handleValue(t){const e=(0,this._fn)(t);for(let t=0;t<e.length;t++)this._emitValue(e[t])}}),Mt=t=>t;const Nt={},qt={_init({wait:t}){this._wait=Math.max(0,t),this._buff=[],this._$shiftBuff=(()=>{const t=this._buff.shift();t===Nt?this._emitEnd():this._emitValue(t)})},_free(){this._buff=null,this._$shiftBuff=null},_handleValue(t){this._activating?this._emitValue(t):(this._buff.push(t),setTimeout(this._$shiftBuff,this._wait))},_handleEnd(){this._activating?this._emitEnd():(this._buff.push(Nt),setTimeout(this._$shiftBuff,this._wait))}},Bt=D("delay",qt),Wt=M("delay",qt);var Ut=Date.now?()=>Date.now():()=>(new Date).getTime();const jt={_init({wait:t,leading:e,trailing:n}){this._wait=Math.max(0,t),this._leading=e,this._trailing=n,this._trailingValue=null,this._timeoutId=null,this._endLater=!1,this._lastCallTime=0,this._$trailingCall=(()=>this._trailingCall())},_free(){this._trailingValue=null,this._$trailingCall=null},_handleValue(t){if(this._activating)this._emitValue(t);else{let e=Ut();0!==this._lastCallTime||this._leading||(this._lastCallTime=e);let n=this._wait-(e-this._lastCallTime);n<=0?(this._cancelTrailing(),this._lastCallTime=e,this._emitValue(t)):this._trailing&&(this._cancelTrailing(),this._trailingValue=t,this._timeoutId=setTimeout(this._$trailingCall,n))}},_handleEnd(){this._activating?this._emitEnd():this._timeoutId?this._endLater=!0:this._emitEnd()},_cancelTrailing(){null!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},_trailingCall(){this._emitValue(this._trailingValue),this._timeoutId=null,this._trailingValue=null,this._lastCallTime=this._leading?Ut():0,this._endLater&&this._emitEnd()}},Ft=D("throttle",jt),Qt=M("throttle",jt);const zt={_init({wait:t,immediate:e}){this._wait=Math.max(0,t),this._immediate=e,this._lastAttempt=0,this._timeoutId=null,this._laterValue=null,this._endLater=!1,this._$later=(()=>this._later())},_free(){this._laterValue=null,this._$later=null},_handleValue(t){this._activating?this._emitValue(t):(this._lastAttempt=Ut(),this._immediate&&!this._timeoutId&&this._emitValue(t),this._timeoutId||(this._timeoutId=setTimeout(this._$later,this._wait)),this._immediate||(this._laterValue=t))},_handleEnd(){this._activating?this._emitEnd():this._timeoutId&&!this._immediate?this._endLater=!0:this._emitEnd()},_later(){let t=Ut()-this._lastAttempt;t<this._wait&&t>=0?this._timeoutId=setTimeout(this._$later,this._wait-t):(this._timeoutId=null,this._immediate||(this._emitValue(this._laterValue),this._laterValue=null),this._endLater&&this._emitEnd())}},Yt=D("debounce",zt),Kt=M("debounce",zt);const Rt={_init({fn:t}){this._fn=t},_free(){this._fn=null},_handleError(t){const e=this._fn;this._emitError(e(t))}},Gt=D("mapErrors",Rt),Jt=M("mapErrors",Rt),Xt=t=>t;const Zt={_init({fn:t}){this._fn=t},_free(){this._fn=null},_handleError(t){(0,this._fn)(t)&&this._emitError(t)}},te=D("filterErrors",Zt),ee=M("filterErrors",Zt),ne=t=>t;const ie={_handleValue(){}},se=D("ignoreValues",ie),re=M("ignoreValues",ie);const he={_handleError(){}},oe=D("ignoreErrors",he),ue=M("ignoreErrors",he);const le={_handleEnd(){}},ae=D("ignoreEnd",le),_e=M("ignoreEnd",le);const ce={_init({fn:t}){this._fn=t},_free(){this._fn=null},_handleEnd(){const t=this._fn;this._emitValue(t()),this._emitEnd()}},fe=D("beforeEnd",ce),de=M("beforeEnd",ce);const pe={_init({min:t,max:e}){this._max=e,this._min=t,this._buff=[]},_free(){this._buff=null},_handleValue(t){this._buff=function(t,e,n){let i,s=Math.min(n,t.length+1),r=t.length-s+1,h=new Array(s);for(i=r;i<s;i++)h[i-r]=t[i];return h[s-1]=e,h}(this._buff,t,this._max),this._buff.length>=this._min&&this._emitValue(this._buff)}},me=D("slidingWindow",pe),ye=M("slidingWindow",pe);const ve={_init({fn:t,flushOnEnd:e}){this._fn=t,this._flushOnEnd=e,this._buff=[]},_free(){this._buff=null},_flush(){null!==this._buff&&0!==this._buff.length&&(this._emitValue(this._buff),this._buff=[])},_handleValue(t){this._buff.push(t),(0,this._fn)(t)||this._flush()},_handleEnd(){this._flushOnEnd&&this._flush(),this._emitEnd()}},be=D("bufferWhile",ve),Ee=M("bufferWhile",ve),ge=t=>t;const we={_init({count:t,flushOnEnd:e}){this._count=t,this._flushOnEnd=e,this._buff=[]},_free(){this._buff=null},_flush(){null!==this._buff&&0!==this._buff.length&&(this._emitValue(this._buff),this._buff=[])},_handleValue(t){this._buff.push(t),this._buff.length>=this._count&&this._flush()},_handleEnd(){this._flushOnEnd&&this._flush(),this._emitEnd()}},Ae=D("bufferWithCount",we),Se=M("bufferWithCount",we);const Ve={_init({wait:t,count:e,flushOnEnd:n}){this._wait=t,this._count=e,this._flushOnEnd=n,this._intervalId=null,this._$onTick=(()=>this._flush()),this._buff=[]},_free(){this._$onTick=null,this._buff=null},_flush(){null!==this._buff&&(this._emitValue(this._buff),this._buff=[])},_handleValue(t){this._buff.push(t),this._buff.length>=this._count&&(clearInterval(this._intervalId),this._flush(),this._intervalId=setInterval(this._$onTick,this._wait))},_handleEnd(){this._flushOnEnd&&0!==this._buff.length&&this._flush(),this._emitEnd()},_onActivation(){this._intervalId=setInterval(this._$onTick,this._wait),this._source.onAny(this._$handleAny)},_onDeactivation(){null!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null),this._source.offAny(this._$handleAny)}},Te=D("bufferWithTimeOrCount",Ve),$e=M("bufferWithTimeOrCount",Ve);const Ce={_init({transducer:t}){var e;this._xform=t((e=this,{"@@transducer/step":(t,n)=>(e._emitValue(n),null),"@@transducer/result":()=>(e._emitEnd(),null)}))},_free(){this._xform=null},_handleValue(t){null!==this._xform["@@transducer/step"](null,t)&&this._xform["@@transducer/result"](null)},_handleEnd(){this._xform["@@transducer/result"](null)}},ke=D("transduce",Ce),Ie=M("transduce",Ce);const Oe={_init({fn:t}){this._handler=t,this._emitter=V(this)},_free(){this._handler=null,this._emitter=null},_handleAny(t){this._handler(this._emitter,t)}},xe=D("withHandler",Oe),Le=M("withHandler",Oe);const Pe=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function He(t,e){m.call(this),this._buffers=c(t,t=>Pe(t)?a(t):[]),this._sources=c(t,t=>Pe(t)?b():t),this._combinator=e?k(e,this._sources.length):t=>t,this._aliveCount=0,this._$handlers=[];for(let t=0;t<this._sources.length;t++)this._$handlers.push(e=>this._handleAny(t,e))}function De(t,e){return 0===t.length?b():new He(t,e)}e(He,m,{_name:"zip",_onActivation(){for(;this._isFull();)this._emit();const t=this._sources.length;this._aliveCount=t;for(let e=0;e<t&&this._active;e++)this._sources[e].onAny(this._$handlers[e])},_onDeactivation(){for(let t=0;t<this._sources.length;t++)this._sources[t].offAny(this._$handlers[t])},_emit(){let t=new Array(this._buffers.length);for(let e=0;e<this._buffers.length;e++)t[e]=this._buffers[e].shift();const e=this._combinator;this._emitValue(e(t))},_isFull(){for(let t=0;t<this._buffers.length;t++)if(0===this._buffers[t].length)return!1;return!0},_handleAny(t,e){e.type===s&&(this._buffers[t].push(e.value),this._isFull()&&this._emit()),e.type===r&&this._emitError(e.value),e.type===i&&(this._aliveCount--,0===this._aliveCount&&this._emitEnd())},_clear(){m.prototype._clear.call(this),this._sources=null,this._buffers=null,this._combinator=null,this._$handlers=null}});const Me=t=>t;function Ne({queueLim:t=0,concurLim:e=-1,drop:n="new"}={}){m.call(this),this._queueLim=t<0?-1:t,this._concurLim=e<0?-1:e,this._drop=n,this._queue=[],this._curSources=[],this._$handleSubAny=(t=>this._handleSubAny(t)),this._$endHandlers=[],this._currentlyAdding=null,0===this._concurLim&&this._emitEnd()}function qe(t){Ne.call(this),this._addAll(t),this._initialised=!0}function Be(t){return 0===t.length?b():new qe(t)}function We(t){m.call(this),this._generator=t,this._source=null,this._inLoop=!1,this._iteration=0,this._$handleAny=(t=>this._handleAny(t))}function Ue(t){return new We(t)}function je(t){return Ue(function(e){return t.length>e&&t[e]}).setName("concat")}function Fe(){Ne.call(this)}function Qe(t,e,n){Ne.call(this,n),this._source=t,this._fn=e,this._mainEnded=!1,this._lastCurrent=null,this._$handleMain=(t=>this._handleMain(t))}function ze(t,e){Qe.call(this,t,e)}function Ye(t,e){return function(i,s,r){t.call(this),this._primary=i,this._secondary=s,this._name=`${i._name}.${e}`,this._lastSecondary=n,this._$handleSecondaryAny=(t=>this._handleSecondaryAny(t)),this._$handlePrimaryAny=(t=>this._handlePrimaryAny(t)),this._init(r)}}function Ke(t){return{_init(){},_free(){},_handlePrimaryValue(t){this._emitValue(t)},_handlePrimaryError(t){this._emitError(t)},_handlePrimaryEnd(){this._emitEnd()},_handleSecondaryValue(t){this._lastSecondary=t},_handleSecondaryError(t){this._emitError(t)},_handleSecondaryEnd(){},_handlePrimaryAny(t){switch(t.type){case s:return this._handlePrimaryValue(t.value);case r:return this._handlePrimaryError(t.value);case i:return this._handlePrimaryEnd(t.value)}},_handleSecondaryAny(t){switch(t.type){case s:return this._handleSecondaryValue(t.value);case r:return this._handleSecondaryError(t.value);case i:this._handleSecondaryEnd(t.value),this._removeSecondary()}},_removeSecondary(){null!==this._secondary&&(this._secondary.offAny(this._$handleSecondaryAny),this._$handleSecondaryAny=null,this._secondary=null)},_onActivation(){null!==this._secondary&&this._secondary.onAny(this._$handleSecondaryAny),this._active&&this._primary.onAny(this._$handlePrimaryAny)},_onDeactivation(){null!==this._secondary&&this._secondary.offAny(this._$handleSecondaryAny),this._primary.offAny(this._$handlePrimaryAny)},_clear(){t.prototype._clear.call(this),this._primary=null,this._secondary=null,this._lastSecondary=null,this._$handleSecondaryAny=null,this._$handlePrimaryAny=null,this._free()}}}function Re(t,n){const i=Ye(m,t);return e(i,m,Ke(m),n),i}function Ge(t,n){const i=Ye(y,t);return e(i,y,Ke(y),n),i}e(Ne,m,{_name:"abstractPool",_add(t,e){e=e||Me,-1===this._concurLim||this._curSources.length<this._concurLim?this._addToCur(e(t)):-1===this._queueLim||this._queue.length<this._queueLim?this._addToQueue(e(t)):"old"===this._drop&&(this._removeOldest(),this._add(t,e))},_addAll(t){!function(t,e){let n,i=t.length;for(n=0;n<i;n++)e(t[n])}(t,t=>this._add(t))},_remove(t){-1===this._removeCur(t)&&this._removeQueue(t)},_addToQueue(t){this._queue=o(this._queue,[t])},_addToCur(t){if(this._active){if(!t._alive)return void(t._currentEvent&&this._emit(t._currentEvent.type,t._currentEvent.value));this._currentlyAdding=t,t.onAny(this._$handleSubAny),this._currentlyAdding=null,t._alive&&(this._curSources=o(this._curSources,[t]),this._active&&this._subToEnd(t))}else this._curSources=o(this._curSources,[t])},_subToEnd(t){const e=()=>this._removeCur(t);this._$endHandlers.push({obs:t,handler:e}),t.onEnd(e)},_subscribe(t){t.onAny(this._$handleSubAny),this._active&&this._subToEnd(t)},_unsubscribe(t){t.offAny(this._$handleSubAny);let e=l(this._$endHandlers,e=>e.obs===t);-1!==e&&(t.offEnd(this._$endHandlers[e].handler),this._$endHandlers.splice(e,1))},_handleSubAny(t){t.type===s?this._emitValue(t.value):t.type===r&&this._emitError(t.value)},_removeQueue(t){let e=u(this._queue,t);return this._queue=_(this._queue,e),e},_removeCur(t){this._active&&this._unsubscribe(t);let e=u(this._curSources,t);return this._curSources=_(this._curSources,e),-1!==e&&(0!==this._queue.length?this._pullQueue():0===this._curSources.length&&this._onEmpty()),e},_removeOldest(){this._removeCur(this._curSources[0])},_pullQueue(){0!==this._queue.length&&(this._queue=a(this._queue),this._addToCur(this._queue.shift()))},_onActivation(){for(let t=0,e=this._curSources;t<e.length&&this._active;t++)this._subscribe(e[t])},_onDeactivation(){for(let t=0,e=this._curSources;t<e.length;t++)this._unsubscribe(e[t]);null!==this._currentlyAdding&&this._unsubscribe(this._currentlyAdding)},_isEmpty(){return 0===this._curSources.length},_onEmpty(){},_clear(){m.prototype._clear.call(this),this._queue=null,this._curSources=null,this._$handleSubAny=null,this._$endHandlers=null}}),e(qe,Ne,{_name:"merge",_onEmpty(){this._initialised&&this._emitEnd()}}),e(We,m,{_name:"repeat",_handleAny(t){t.type===i?(this._source=null,this._getSource()):this._emit(t.type,t.value)},_getSource(){if(!this._inLoop){this._inLoop=!0;const t=this._generator;for(;null===this._source&&this._alive&&this._active;)this._source=t(this._iteration++),this._source?this._source.onAny(this._$handleAny):this._emitEnd();this._inLoop=!1}},_onActivation(){this._source?this._source.onAny(this._$handleAny):this._getSource()},_onDeactivation(){this._source&&this._source.offAny(this._$handleAny)},_clear(){m.prototype._clear.call(this),this._generator=null,this._source=null,this._$handleAny=null}}),e(Fe,Ne,{_name:"pool",plug(t){return this._add(t),this},unplug(t){return this._remove(t),this}}),e(Qe,Ne,{_onActivation(){Ne.prototype._onActivation.call(this),this._active&&this._source.onAny(this._$handleMain)},_onDeactivation(){Ne.prototype._onDeactivation.call(this),this._source.offAny(this._$handleMain),this._hadNoEvSinceDeact=!0},_handleMain(t){if(t.type===s){this._activating&&this._hadNoEvSinceDeact&&this._lastCurrent===t.value||this._add(t.value,this._fn),this._lastCurrent=t.value,this._hadNoEvSinceDeact=!1}t.type===r&&this._emitError(t.value),t.type===i&&(this._isEmpty()?this._emitEnd():this._mainEnded=!0)},_onEmpty(){this._mainEnded&&this._emitEnd()},_clear(){Ne.prototype._clear.call(this),this._source=null,this._lastCurrent=null,this._$handleMain=null}}),e(ze,Qe,{_handleMain(t){if(t.type===r){this._activating&&this._hadNoEvSinceDeact&&this._lastCurrent===t.value||this._add(t.value,this._fn),this._lastCurrent=t.value,this._hadNoEvSinceDeact=!1}t.type===s&&this._emitValue(t.value),t.type===i&&(this._isEmpty()?this._emitEnd():this._mainEnded=!0)}});const Je={_handlePrimaryValue(t){this._lastSecondary!==n&&this._lastSecondary&&this._emitValue(t)},_handleSecondaryEnd(){this._lastSecondary!==n&&this._lastSecondary||this._emitEnd()}},Xe=Re("filterBy",Je),Ze=Ge("filterBy",Je);const tn=(t,e)=>e;const en={_handlePrimaryValue(t){this._lastSecondary!==n&&this._emitValue(t)},_handleSecondaryEnd(){this._lastSecondary===n&&this._emitEnd()}},nn=Re("skipUntilBy",en),sn=Ge("skipUntilBy",en);const rn={_handleSecondaryValue(){this._emitEnd()}},hn=Re("takeUntilBy",rn),on=Ge("takeUntilBy",rn);const un={_init({flushOnEnd:t=!0}={}){this._buff=[],this._flushOnEnd=t},_free(){this._buff=null},_flush(){null!==this._buff&&(this._emitValue(this._buff),this._buff=[])},_handlePrimaryEnd(){this._flushOnEnd&&this._flush(),this._emitEnd()},_onActivation(){this._primary.onAny(this._$handlePrimaryAny),this._alive&&null!==this._secondary&&this._secondary.onAny(this._$handleSecondaryAny)},_handlePrimaryValue(t){this._buff.push(t)},_handleSecondaryValue(){this._flush()},_handleSecondaryEnd(){this._flushOnEnd||this._emitEnd()}},ln=Re("bufferBy",un),an=Ge("bufferBy",un);const _n={_init({flushOnEnd:t=!0,flushOnChange:e=!1}={}){this._buff=[],this._flushOnEnd=t,this._flushOnChange=e},_free(){this._buff=null},_flush(){null!==this._buff&&(this._emitValue(this._buff),this._buff=[])},_handlePrimaryEnd(){this._flushOnEnd&&this._flush(),this._emitEnd()},_handlePrimaryValue(t){this._buff.push(t),this._lastSecondary===n||this._lastSecondary||this._flush()},_handleSecondaryEnd(){this._flushOnEnd||this._lastSecondary!==n&&!this._lastSecondary||this._emitEnd()},_handleSecondaryValue(t){this._flushOnChange&&!t&&this._flush(),this._lastSecondary=t}},cn=Re("bufferWhileBy",_n),fn=Ge("bufferWhileBy",_n);const dn=()=>!1,pn=()=>!0;const mn={_init({fn:t}){this._fn=t},_free(){this._fn=null},_handleValue(t){let e=(0,this._fn)(t);e.convert?this._emitError(e.error):this._emitValue(t)}},yn=D("valuesToErrors",mn),vn=M("valuesToErrors",mn),bn=t=>({convert:!0,error:t});const En={_init({fn:t}){this._fn=t},_free(){this._fn=null},_handleError(t){const e=(0,this._fn)(t);e.convert?this._emitValue(e.value):this._emitError(t)}},gn=D("errorsToValues",En),wn=M("errorsToValues",En),An=t=>({convert:!0,value:t});const Sn={_handleError(t){this._emitError(t),this._emitEnd()}},Vn=D("endOnError",Sn),Tn=M("endOnError",Sn);p.prototype.toProperty=function(t){return q(this,t)},p.prototype.changes=function(){return new B(this)},p.prototype.toPromise=function(t){return function(t,e=W()){let n=null;return new e((e,r)=>{t.onAny(t=>{t.type===i&&null!==n?((n.type===s?e:r)(n.value),n=null):n=t})})}(this,t)},p.prototype.toESObservable=Q,p.prototype[j]=Q,p.prototype.map=function(t){return et(this,t)},p.prototype.filter=function(t){return function(t,e=rt){return new(t._ofSameType(it,st))(t,{fn:e})}(this,t)},p.prototype.take=function(t){return function(t,e){return new(t._ofSameType(ot,ut))(t,{n:e})}(this,t)},p.prototype.takeErrors=function(t){return function(t,e){return new(t._ofSameType(at,_t))(t,{n:e})}(this,t)},p.prototype.takeWhile=function(t){return function(t,e=pt){return new(t._ofSameType(ft,dt))(t,{fn:e})}(this,t)},p.prototype.last=function(){return new((t=this)._ofSameType(yt,vt))(t);var t},p.prototype.skip=function(t){return function(t,e){return new(t._ofSameType(Et,gt))(t,{n:e})}(this,t)},p.prototype.skipWhile=function(t){return function(t,e=Vt){return new(t._ofSameType(At,St))(t,{fn:e})}(this,t)},p.prototype.skipDuplicates=function(t){return It(this,t)},p.prototype.diff=function(t,e){return function(t,e,i=n){return new(t._ofSameType(xt,Lt))(t,{fn:e||Pt,seed:i})}(this,t,e)},p.prototype.scan=function(t,e){return function(t,e,i=n){return new Ht(t,{fn:e,seed:i})}(this,t,e)},p.prototype.flatten=function(t){return function(t,e=Mt){return new Dt(t,{fn:e})}(this,t)},p.prototype.delay=function(t){return function(t,e){return new(t._ofSameType(Bt,Wt))(t,{wait:e})}(this,t)},p.prototype.throttle=function(t,e){return function(t,e,{leading:n=!0,trailing:i=!0}={}){return new(t._ofSameType(Ft,Qt))(t,{wait:e,leading:n,trailing:i})}(this,t,e)},p.prototype.debounce=function(t,e){return function(t,e,{immediate:n=!1}={}){return new(t._ofSameType(Yt,Kt))(t,{wait:e,immediate:n})}(this,t,e)},p.prototype.mapErrors=function(t){return function(t,e=Xt){return new(t._ofSameType(Gt,Jt))(t,{fn:e})}(this,t)},p.prototype.filterErrors=function(t){return function(t,e=ne){return new(t._ofSameType(te,ee))(t,{fn:e})}(this,t)},p.prototype.ignoreValues=function(){return new((t=this)._ofSameType(se,re))(t);var t},p.prototype.ignoreErrors=function(){return new((t=this)._ofSameType(oe,ue))(t);var t},p.prototype.ignoreEnd=function(){return new((t=this)._ofSameType(ae,_e))(t);var t},p.prototype.beforeEnd=function(t){return function(t,e){return new(t._ofSameType(fe,de))(t,{fn:e})}(this,t)},p.prototype.slidingWindow=function(t,e){return function(t,e,n=0){return new(t._ofSameType(me,ye))(t,{min:n,max:e})}(this,t,e)},p.prototype.bufferWhile=function(t,e){return function(t,e,{flushOnEnd:n=!0}={}){return new(t._ofSameType(be,Ee))(t,{fn:e||ge,flushOnEnd:n})}(this,t,e)},p.prototype.bufferWithCount=function(t,e){return function(t,e,{flushOnEnd:n=!0}={}){return new(t._ofSameType(Ae,Se))(t,{count:e,flushOnEnd:n})}(this,t,e)},p.prototype.bufferWithTimeOrCount=function(t,e,n){return function(t,e,n,{flushOnEnd:i=!0}={}){return new(t._ofSameType(Te,$e))(t,{wait:e,count:n,flushOnEnd:i})}(this,t,e,n)},p.prototype.transduce=function(t){return function(t,e){return new(t._ofSameType(ke,Ie))(t,{transducer:e})}(this,t)},p.prototype.withHandler=function(t){return function(t,e){return new(t._ofSameType(xe,Le))(t,{fn:e})}(this,t)},p.prototype.thru=function(t){return t(this)},p.prototype.combine=function(t,e){return K([this,t],e)},p.prototype.zip=function(t,e){return De([this,t],e)},p.prototype.merge=function(t){return Be([this,t])},p.prototype.concat=function(t){return je([this,t])};p.prototype.flatMap=function(t){return new Qe(this,t).setName(this,"flatMap")},p.prototype.flatMapLatest=function(t){return new Qe(this,t,{concurLim:1,drop:"old"}).setName(this,"flatMapLatest")},p.prototype.flatMapFirst=function(t){return new Qe(this,t,{concurLim:1}).setName(this,"flatMapFirst")},p.prototype.flatMapConcat=function(t){return new Qe(this,t,{queueLim:-1,concurLim:1}).setName(this,"flatMapConcat")},p.prototype.flatMapConcurLimit=function(t,e){return new Qe(this,t,{queueLim:-1,concurLim:e}).setName(this,"flatMapConcurLimit")},p.prototype.flatMapErrors=function(t){return new ze(this,t).setName(this,"flatMapErrors")},p.prototype.filterBy=function(t){return n=t,new((e=this)._ofSameType(Xe,Ze))(e,n);var e,n},p.prototype.sampledBy=function(t,e){return function(t,e,n){return K([e],[t],n?(t,e)=>n(e,t):tn).setName(t,"sampledBy")}(this,t,e)},p.prototype.skipUntilBy=function(t){return n=t,new((e=this)._ofSameType(nn,sn))(e,n);var e,n},p.prototype.takeUntilBy=function(t){return n=t,new((e=this)._ofSameType(hn,on))(e,n);var e,n},p.prototype.bufferBy=function(t,e){return function(t,e,n){return new(t._ofSameType(ln,an))(t,e,n)}(this,t,e)},p.prototype.bufferWhileBy=function(t,e){return function(t,e,n){return new(t._ofSameType(cn,fn))(t,e,n)}(this,t,e)};let $n=!0;function Cn(t){if($n&&console&&"function"==typeof console.warn){const e="\nHere is an Error object for you containing the call stack:";console.warn(t,e,new Error)}}p.prototype.awaiting=function(t){return Cn("You are using deprecated .awaiting() method, see https://github.com/kefirjs/kefir/issues/145"),function(t,e){let n=Be([et(t,pn),et(e,dn)]);return(n=q(n=It(n),dn)).setName(t,"awaiting")}(this,t)},p.prototype.valuesToErrors=function(t){return Cn("You are using deprecated .valuesToErrors() method, see https://github.com/kefirjs/kefir/issues/149"),function(t,e=bn){return new(t._ofSameType(yn,vn))(t,{fn:e})}(this,t)},p.prototype.errorsToValues=function(t){return Cn("You are using deprecated .errorsToValues() method, see https://github.com/kefirjs/kefir/issues/149"),function(t,e=An){return new(t._ofSameType(gn,wn))(t,{fn:e})}(this,t)},p.prototype.endOnError=function(){return Cn("You are using deprecated .endOnError() method, see https://github.com/kefirjs/kefir/issues/150"),new((t=this)._ofSameType(Vn,Tn))(t);var t};const kn={Observable:p,Stream:m,Property:y,never:b,later:function(t,e){return new g(t,{x:e})},interval:function(t,e){return new w(t,{x:e})},sequentially:function(t,e){return 0===e.length?b():new A(t,{xs:e})},fromPoll:function(t,e){return new S(t,{fn:e})},withInterval:function(t,e){return new T(t,{fn:e})},fromCallback:function(t){let e=!1;return C(function(n){e||(t(function(t){n.emit(t),n.end()}),e=!0)}).setName("fromCallback")},fromNodeCallback:function(t){let e=!1;return C(function(n){e||(t(function(t,e){t?n.error(t):n.emit(e),n.end()}),e=!0)}).setName("fromNodeCallback")},fromEvents:function(t,e,n){let i,s;for(let e=0;e<I.length;e++)if("function"==typeof t[I[e][0]]&&"function"==typeof t[I[e][1]]){i=I[e][0],s=I[e][1];break}if(void 0===i)throw new Error("target don't support any of addEventListener/removeEventListener, addListener/removeListener, on/off method pair");return function(t,e,n){return C(function(i){let s=n?function(){i.emit(function(t,e,n){let i=n?n.length:0;if(null==e)switch(i){case 0:return t();case 1:return t(n[0]);case 2:return t(n[0],n[1]);case 3:return t(n[0],n[1],n[2]);case 4:return t(n[0],n[1],n[2],n[3]);default:return t.apply(null,n)}else switch(i){case 0:return t.call(e);default:return t.apply(e,n)}}(n,this,arguments))}:t=>{i.emit(t)};return t(s),()=>e(s)}).setName("fromSubUnsub")}(n=>t[i](e,n),n=>t[s](e,n),n).setName("fromEvents")},stream:C,constant:x,constantError:function(t){return new L(t)},fromPromise:function(t){let e=!1;return q(C(function(n){if(!e){let i=function(t){n.emit(t),n.end()},s=function(t){n.error(t),n.end()},r=t.then(i,s);r&&"function"==typeof r.done&&r.done(),e=!0}}),null).setName("fromPromise")},fromESObservable:function(t){const e=t[j]?t[j]():t;return C(function(t){const n=e.subscribe({error(e){t.error(e),t.end()},next(e){t.emit(e)},complete(){t.end()}});return n.unsubscribe?function(){n.unsubscribe()}:n}).setName("fromESObservable")},combine:K,zip:De,merge:Be,concat:je,Pool:Fe,pool:function(){return new Fe},repeat:Ue,staticLand:G};kn.Kefir=kn;let In=function(){let t,e,n,i=function(t,e,n){this.stream=t,this.onUnsubscribe=null,this.subscription=t.observe({value:function(t){e(t.data,t)},error:n}),s(t)};function s(t){t.subscriberCount=t.subscriberCount?t.subscriberCount+1:1}function r(t){t.subscriberCount||--t.subscriberCount||delete n[t._source._channelName].topics[t._binding]}function h(t){if(-1===t.indexOf("#")&&-1===t.indexOf("*"))return function(e){return e.topic===t};{let e=function(t){let e,n="^"+t.split(".").map(function(t){let n="";return e&&(n="#"!==e?"\\.\\b":"\\b"),e=t,n+="#"===t?"[\\s\\S]*":"*"===t?"[^.]+":t}).join("")+"$";return new RegExp(n)}(t);return function(t){return e.test(t.topic)}}}function o(e,i){let s=(n[r=e]||(n[r]={stream:t.filter(function(t){return t.channel===r}),topics:{}},n[r].stream._channelName=r),n[r]);var r;let o=h(i),u=s.topics[i]||(s.topics[i]=s.stream.filter(function(t){return o(t)}));return u._binding=i,u}function u(){n={},e&&e.end(),e=null,t=kn.stream(function(t){return e=t,function(){e=null}})}return i.prototype.unsubscribe=function(){"function"==typeof this.onUnsubscribe&&this.onUnsubscribe(),this.subscription.unsubscribe(),r(this.stream)},u(),{publish:function(t){t.timestamp=(new Date).toISOString(),e&&e.emit(t)},subscribe:function(t){return new i(o(t.channel,t.topic),t.callback)},wiretap:function(e){let n=t.observe({value:function(t){e(t.data,t)}});return function(){n.unsubscribe()}},reset:u,when:function(t,e,n,i){let h=[],u=i||{};t.forEach(function(t){let e=o(t.channel,t.topic);s(e),h.push(e)});let l=kn.zip(h),a=(u.once?l.take(1):l).map(function(t){return t.map(function(t){return t.data})}).observe({value:function(t){e.apply(this,t)},error:n,end:_});function _(){a.unsubscribe(),h.forEach(function(t){r(t)}),h=[]}return _}}}();function On(t){On.installed||(In.reset(),Object.defineProperty(t.prototype,"$event",{get:function(){let t=this;return{subscribe:function(){let e=In.subscribe.apply(In,arguments);return e.onUnsubscribe=t.$on("hook:beforeDestroy",function(){e.unsubscribe()}),e},when:function(){let e=In.when.apply(In,arguments);return t.$on("hook:beforeDestroy",function(){e()}),e},publish:In.publish.bind(In),wiretap:In.wiretap.bind(In),reset:In.reset}}}))}return"undefined"!=typeof window&&window.Vue&&window.Vue.use(On),On});
